\documentclass[12pt,a4paper,oneside]{article}

\usepackage[QX]{polski}

\usepackage[utf8]{inputenc}
\usepackage{latexsym}
\usepackage{tgpagella}
\usepackage{lmodern}
\usepackage{amsmath,amsthm,amsfonts,amssymb,alltt}
\usepackage{epsfig}
\usepackage{pdflscape}
\usepackage{caption}
\usepackage{indentfirst}
\usepackage{float}
%\usepackage{showkeys}
\bibliographystyle{plabbrv}


\usepackage{color}
\usepackage[polish]{babel}
\usepackage{datetime2}
\usepackage[x11names,dvipsnames,table]{xcolor}
\usepackage{hyperref}
\hypersetup{
pdfauthor={Roman Czapla, Olaf Bar},
colorlinks=True,
linkcolor=darkgray,  % color of internal links (change box color with linkbordercolor)
citecolor=BrickRed,  % color of links to bibliography
filecolor=Magenta,   % color of file links
urlcolor=BlueViolet}	%%pdfpagemode=FullScreen}

% diagramy, grafy itp.
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{chains,fit,shapes,calc}
\tikzset{main node/.style={circle,fill=blue!20,draw,minimum size=1cm,inner sep=0pt}}

% algorytmy
\usepackage[linesnumbered,lined,commentsnumbered]{algorithm2e}
\SetKwFor{ForEach}{for each}{do}{end for}%
\SetKwFor{ForAll}{for all}{do}{end for}%
\newenvironment{myalgorithm}
{\rule{\textwidth}{0.5mm}\\\SetAlCapSty{}\SetAlgoNoEnd\SetAlgoNoLine\begin{algorithm}}{\end{algorithm}\rule{\textwidth}{0.5mm}}


%---------------------
\overfullrule=2mm
\pagestyle{plain}
\textwidth=15cm \textheight=685pt \topmargin=-25pt \linespread{1.3} 
\setlength{\parskip}{0pt}
\setlength\arraycolsep{2pt}
\oddsidemargin = 0.9cm
\evensidemargin =-0.1cm

\captionsetup{width=.95\linewidth, justification=centering}
%---------------------




\newtheorem{tw}{Twierdzenie}[section]
\newtheorem{lem}[tw]{Lemat}
\newtheorem{co}[tw]{Wniosek}
\newtheorem{prop}[tw]{Stwierdzenie}
\theoremstyle{definition}
\newtheorem{ex}{Przykład}
\newtheorem{re}[tw]{Uwaga}
\newtheorem{de}{Definicja}[section]



\newcommand{\bC}{{\mathbb C}}
\newcommand{\bR}{{\mathbb R}}
\newcommand{\bZ}{{\mathbb Z}}
\newcommand{\bQ}{{\mathbb Q}}
\newcommand{\bN}{{\mathbb N}}
\newcommand{\captionT}[1]{\caption{\textsc{\footnotesize{#1}}}}
\renewcommand\figurename{Rys.}

\numberwithin{equation}{section}
\renewcommand{\thefootnote}{\arabic{footnote})}
%\renewcommand{\thefootnote}{\alph{footnote})}



\begin{document}

% --------------------------------------------
% Strona tytułowa
% --------------------------------------------

\thispagestyle{empty}
\begin{titlepage}
\begin{center}\Large
Uniwersytet Komisji Edukacji Narodowej w Krakowie\\
\large
Instytut Bezpieczeństwa i Informatyki\\
\vskip 10pt
\end{center}
\begin{center}
\centering \includegraphics[width=1.0\columnwidth]{images/logo.png}
\end{center}

\begin{center}
 {\bf \fontsize{14pt}{14pt}\selectfont PROJEKT INŻYNIERSKI \\ DOKUMENTACJA UŻYTKOWA}
\end{center}
\vskip 5pt
\begin{center}
 {\bf \fontsize{22pt}{22pt}\selectfont System WasteFree Cloud do efektywnego zarządzania odpadami}
\end{center}

\begin{center}
 {\fontsize{12pt}{12pt}\selectfont wykonany przez: }
\end{center}
\begin{center}
 {\bf\fontsize{16pt}{16pt}\selectfont Dawid Plata}\\
 {\fontsize{12pt}{12pt}\selectfont Nr albumu: 165303 \\\&\\}
 {\bf\fontsize{16pt}{16pt}\selectfont Michał Szymbara}\\
 {\fontsize{12pt}{12pt}\selectfont Nr albumu: 165297 \\\&\\}
 {\bf\fontsize{16pt}{16pt}\selectfont Michał Wechmann}\\
 {\fontsize{12pt}{12pt}\selectfont Nr albumu: 165298}
\end{center}
\begin{center}
 {\fontsize{12pt}{12pt}\selectfont pod opieką:}\\
 {\bf\fontsize{12pt}{12pt}\selectfont tytuł, imię i nazwisko opiekuna projektu}
\end{center}

%\mbox{}
\vspace*{\fill}
%\vskip 50pt
\begin{center}
\large
Kraków \the\year\\
(ostatnia aktualizacja: \DTMcurrenttime,\;\today)
\end{center}
\end{titlepage}
\setcounter{page}{0} 
\newpage\null\thispagestyle{empty}
%\setcounter{page}{0} 
%\newpage
%\thispagestyle{empty}

\tableofcontents


\newpage

\section{Szczegółowa dokumentacja użytkowa}

\subsection{Role użytkowników i uprawnienia}
System WasteFree Cloud przewiduje kilka ról użytkowników, które różnią się zakresem dostępnych funkcji. Uprawnienia są nadawane automatycznie na podstawie typu konta oraz autoryzacji (logowania). Dzięki temu użytkownik widzi w aplikacji jedynie te elementy, które są dla niego przeznaczone, a operacje wrażliwe (obsługa zleceń) są ograniczone do odpowiednich ról.

\subsubsection{Użytkownik (User)}
Rola \textbf{Użytkownik} przeznaczona jest dla osób korzystających z aplikacji w celu organizacji i rozliczania odbiorów odpadów w ramach grupy.
\begin{itemize}
\item zarządzanie własnym kontem: rejestracja, aktywacja konta, logowanie,
\item wgląd i edycja profilu (m.in. podstawowe dane, adres, miasto),
\item korzystanie z portfela: podgląd salda oraz wykonywanie transakcji (wpłata oraz wypłata),
\item tworzenie i przegląd grup odpadów oraz współpraca z innymi użytkownikami (zaproszenia),
\item składanie zamówień odbioru odpadów, kalkulacja kosztu oraz realizacja płatności,
\item korzystanie ze skrzynki odbiorczej (powiadomienia i akcje) oraz czatu grupowego.
\end{itemize}

\subsubsection{Administrator odpadów (Garbage Admin)}
Rola \textbf{Administrator odpadów} przeznaczona jest dla podmiotów obsługujących zlecenia odbioru odpadów. Użytkownik z tą rolą ma dostęp do funkcji związanych z przyjmowaniem oraz realizacją zamówień.
\begin{itemize}
\item przegląd zleceń oczekujących w przypisanym mieście oraz akceptacja zleceń,
\item wgląd w zlecenia aktualnie przypisane/aktywne,
\item uzupełnianie informacji o kosztach, w tym zgłoszenie opłaty utylizacyjnej wraz z załącznikiem,
\item akceptacja wymaganej zgody (treści zgody) dla administratora odpadów.
\end{itemize}

\subsubsection{Administrator systemu (Admin)}
Rola \textbf{Administrator systemu} jest przewidziana jako rola o najszerszych uprawnieniach. W aktualnej wersji aplikacji administrator ma dostęp do wszystkich zakładek i treści w interfejsie, natomiast nie posiada dodatkowych, dedykowanych funkcji administracyjnych ponad standardowe możliwości dostępne w aplikacji.

\subsection{Nawigacja i elementy interfejsu}
Interfejs użytkownika w aplikacji WasteFree Cloud jest oparty o widoki (strony) dostępne z poziomu nawigacji oraz tzw. portalu użytkownika. Po zalogowaniu użytkownik uzyskuje dostęp do panelu \textit{Portal}, w którym znajdują się funkcje operacyjne (portfel, skrzynka odbiorcza, grupy, zamówienia, profil). Część elementów interfejsu (w szczególności przyciski akcji) może różnić się w zależności od roli.

\subsubsection{Strona główna}
Strona główna jest punktem startowym aplikacji. Z tego miejsca użytkownik może przejść do logowania/rejestracji lub do portalu (jeżeli jest już zalogowany).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek1.png}
\captionT{Strona główna aplikacji}
\end{figure}

\subsubsection{Portal użytkownika}
Portal użytkownika stanowi główny obszar pracy w aplikacji. W portalu dostępne są podstrony związane z realizacją funkcjonalności systemu, m.in.:
\begin{itemize}
\item \textbf{Portfel} (saldo i transakcje),
\item \textbf{Skrzynka odbiorcza} (wiadomości oraz akcje),
\item \textbf{Zamówienia odbioru} (tworzenie i podgląd),
\item \textbf{Grupy} (lista, zarządzanie i panel grupy),
\item \textbf{Profil} (dane użytkownika).
\end{itemize}

\subsubsection{Dashboard (widok startowy portalu)}
Po zalogowaniu użytkownik trafia do widoku startowego portalu (dashboard). Dashboard prezentuje podsumowanie najważniejszych informacji oraz ułatwia szybkie przejście do kluczowych funkcji aplikacji.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek2.png}
\captionT{Dashboard w portalu użytkownika}
\end{figure}



\subsubsection{Topbar, przełącznik języka i nawigacja}
W górnej części aplikacji dostępny jest pasek nawigacyjny (topbar), który ułatwia przechodzenie pomiędzy zakładkami. W interfejsie występuje również przełącznik języka, dzięki któremu użytkownik może zmienić język wyświetlanych treści (o ile są dostępne tłumaczenia).

Elementy nawigacji mogą obejmować m.in. przejście do portfela, skrzynki odbiorczej, grup, profilu oraz innych modułów. Dodatkowo w topbarze może pojawiać się informacja o liczbie nowych powiadomień w skrzynce odbiorczej.


\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek3.png}
\captionT{Nawigacja w aplikacji (topbar i przełącznik języka)}
\end{figure}

\subsubsection{Komunikaty, walidacja i obsługa błędów}
Podczas korzystania z aplikacji użytkownik może otrzymywać komunikaty o poprawnym wykonaniu operacji (zapis profilu, utworzenie zamówienia) oraz komunikaty o błędach. Walidacja danych w formularzach rejestracji lub płatności ma na celu wskazanie brakujących lub niepoprawnych informacji jeszcze przed wysłaniem danych.

W przypadku wystąpienia błędu po stronie systemu aplikacja prezentuje odpowiedni komunikat, a użytkownik może ponowić operację lub skorygować dane wejściowe.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek4.png}
\captionT{Przykładowy komunikat błędu}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek5.png}
\captionT{Komunikat o poprawnym wykonaniu operacji}
\end{figure}

\subsection{Konto i uwierzytelnianie}
Moduł konta i uwierzytelniania umożliwia utworzenie konta w systemie WasteFree Cloud oraz uzyskanie dostępu do funkcji dostępnych w portalu. Proces składa się z trzech podstawowych etapów: rejestracji, aktywacji konta oraz logowania.

\subsubsection{Rejestracja konta}
Rejestracja polega na założeniu konta poprzez wypełnienie formularza rejestracyjnego. Użytkownik podaje: nazwę użytkownika, adres e-mail, hasło oraz wybiera rolę konta (User lub GarbageAdmin). W kolejnym kroku wybiera preferowany język oraz uzupełnia adres w postaci: miasto, kod pocztowy oraz ulica wraz z numerem.

Miasto wybierane jest z listy pobieranej z systemu w postaci zapytania do API. Podczas wypełniania formularza adres jest weryfikowany: kod pocztowy musi odpowiadać wybranemu miastu, a pole ulicy musi zawierać numer.

Po przesłaniu formularza backend wykonuje dodatkowo weryfikację adresu poprzez \textbf{geokodowanie} z wykorzystaniem usługi \textbf{OpenStreetMap (Nominatim)} w celu wyznaczenia współrzędnych. Jeżeli adres nie zostanie odnaleziony lub nie uda się wyznaczyć współrzędnych, utworzenie konta może zostać odrzucone z komunikatem błędu.

Po poprawnym przesłaniu formularza konto zostaje utworzone, a na podany adres e-mail wysyłana jest wiadomość z linkiem aktywacyjnym.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek6.png}
\captionT{Rejestracja nowego konta}
\end{figure}

\subsubsection{Aktywacja konta (link e-mail)}
Po rejestracji użytkownik otrzymuje e-mail z linkiem aktywacyjnym. Po kliknięciu linku następuje weryfikacja konta i jego aktywacja. Dopiero po aktywacji możliwe jest poprawne zalogowanie się do systemu.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek7.png}
\captionT{Aktywacja konta użytkownika}
\end{figure}

\subsubsection{Logowanie i wylogowanie}
Logowanie odbywa się poprzez podanie nazwy użytkownika oraz hasła w formularzu logowania. Po poprawnej autoryzacji użytkownik zostaje przeniesiony do portalu aplikacji, a system zapisuje informację o sesji w postaci tokenu JWT wykorzystywanego do uwierzytelniania kolejnych żądań.

Wylogowanie kończy sesję użytkownika i uniemożliwia dostęp do funkcji wymagających uwierzytelnienia. Po wylogowaniu użytkownik może ponownie zalogować się lub przejść do rejestracji.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek8.png}
\captionT{Ekran logowania i przejście do rejestracji}
\end{figure}

\subsection{Profil użytkownika}
Sekcja profilu użytkownika służy do zarządzania danymi konta widocznymi w systemie oraz do uzupełniania informacji wykorzystywanych w pozostałych modułach (grupy, zamówienia, rozliczenia). Profil jest dostępny po zalogowaniu w portalu aplikacji.

\subsubsection{Podgląd i edycja profilu}
W widoku profilu użytkownik ma możliwość podglądu oraz edycji podstawowych informacji o koncie. W profilu przechowywane są m.in. opis użytkownika oraz numer rachunku bankowego wykorzystywany do rozliczeń w portfelu.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek9.png}
\captionT{Podgląd profilu użytkownika}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek10.png}
\captionT{Edycja danych profilu}
\end{figure}

\subsubsection{Adres i miasto (dostępne miasta)}
Adres użytkownika jest wykorzystywany w systemie do dopasowania usług i działania wybranych funkcji. Użytkownik uzupełnia dane adresowe w formie: miasto, kod pocztowy oraz ulica wraz z numerem.

Miasto wybierane jest z listy dostępnych lokalizacji w systemie. Aplikacja obsługuje miasta: Kraków oraz Warszawa.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek11.png}
\captionT{Adres i miasto w profilu użytkownika}
\end{figure}

\subsubsection{Avatar użytkownika (upload)}
Użytkownik może dodać lub zmienić avatar. Avatar służy do identyfikacji użytkownika w aplikacji (m.in. w panelach grup oraz w szczegółach zamówień).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek12.png}
\captionT{Dodawanie lub zmiana avatara}
\end{figure}

\subsection{Portfel (Wallet)}
Moduł \textbf{Portfel} służy do obsługi środków pieniężnych użytkownika wykorzystywanych w aplikacji. Umożliwia sprawdzenie aktualnego salda oraz wykonanie operacji wpłaty i wypłaty.

\subsubsection{Saldo}
Saldo portfela prezentowane jest w górnej części widoku portfela w walucie \textbf{PLN}. Wartość salda jest pobierana z systemu po otwarciu widoku oraz odświeżana po poprawnym zakończeniu transakcji.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek13.png}
\captionT{Saldo portfela użytkownika}
\end{figure}

\subsubsection{Dostępne metody płatności}
W aplikacji dostępne są metody przypisane do typu operacji:
\begin{itemize}
\item \textbf{BLIK} --- metoda wykorzystywana do \textbf{wpłaty środków} do portfela,
\item \textbf{Wypłata bankowa (IBAN)} --- metoda wykorzystywana do \textbf{wypłaty środków} na numer rachunku bankowego użytkownika.
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek14.png}
\captionT{Metody transakcji w portfelu}
\end{figure}

\subsubsection{Wpłata środków}
Wpłata środków realizowana jest poprzez formularz wpłaty. Użytkownik podaje kwotę (minimalnie 1) oraz \textbf{kod BLIK} składający się z 6 cyfr. System weryfikuje poprawność kodu, a po udanej operacji saldo portfela zostaje zaktualizowane.

W aktualnej wersji systemu kod BLIK wymagany do poprawnego zaksięgowania wpłaty musi rozpoczynać się od cyfr \textbf{777}.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek15.png}
\captionT{Wpłata środków do portfela (BLIK)}
\end{figure}

\subsubsection{Wypłata środków}
Wypłata środków realizowana jest na numer rachunku bankowego użytkownika zapisany w profilu (\textbf{IBAN}). Numer rachunku jest prezentowany w widoku portfela jako informacja tylko do odczytu.

Aby wykonać wypłatę użytkownik podaje kwotę (minimalnie 1). System weryfikuje, czy numer rachunku jest uzupełniony oraz czy użytkownik posiada wystarczające środki w portfelu. Po udanej operacji saldo portfela zostaje zaktualizowane.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek16.png}
\captionT{Wypłata środków z portfela (IBAN)}
\end{figure}

\subsection{Grupy odpadów (Garbage Groups)}
Moduł \textbf{Grupy odpadów} umożliwia organizację użytkowników w ramach wspólnego miejsca odbioru odpadów. Grupa posiada nazwę, opis oraz adres (miasto, kod pocztowy, ulica z numerem). Lista dostępnych miast jest pobierana z systemu w postaci zapytania do API. W ramach grupy widoczna jest lista członków oraz dostępne są akcje związane z zapraszaniem nowych osób i zarządzaniem danymi grupy.

\subsubsection{Lista grup}
W widoku listy grup użytkownik widzi wszystkie grupy, do których należy. Każda pozycja na liście zawiera nazwę grupy oraz informację o roli użytkownika w grupie (właściciel lub członek). Wybranie grupy z listy przenosi do panelu szczegółów grupy.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek17.png}
\captionT{Lista grup użytkownika}
\end{figure}

\subsubsection{Rejestracja nowej grupy}
Rejestracja nowej grupy odbywa się poprzez formularz zarządzania grupami. Użytkownik uzupełnia:
\begin{itemize}
\item nazwę grupy,
\item opis grupy,
\item adres miejsca odbioru (miasto wybierane z listy, kod pocztowy, ulica wraz z numerem).
\end{itemize}
Podczas wypełniania formularza adres jest weryfikowany: kod pocztowy musi odpowiadać wybranemu miastu, a pole ulicy musi zawierać numer. Po zatwierdzeniu dane formularza są wysyłane do systemu w zapytaniu, a w przypadku błędów użytkownik otrzymuje komunikaty walidacyjne.
Backend dodatkowo wykonuje weryfikację adresu poprzez \textbf{geokodowanie} z wykorzystaniem usługi \textbf{OpenStreetMap (Nominatim)} w celu wyznaczenia współrzędnych (szerokość i długość geograficzna). Jeżeli adres nie zostanie odnaleziony lub nie uda się wyznaczyć współrzędnych, zapis danych może zostać odrzucony z komunikatem błędu.
Po poprawnym utworzeniu grupy użytkownik staje się jej \textbf{właścicielem} i może przejść do szczegółów nowo utworzonej grupy.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek18.png}
\captionT{Tworzenie nowej grupy}
\end{figure}

\subsubsection{Szczegóły grupy}
Szczegóły grupy są dostępne w panelu grupy po wybraniu jej z listy. W widoku szczegółów prezentowane są:
\begin{itemize}
\item opis grupy,
\item adres miejsca odbioru,
\item lista członków grupy wraz z rolą oraz informacją, czy zaproszenie użytkownika jest oczekujące.
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek19.png}
\captionT{Szczegóły grupy}
\end{figure}

\subsubsection{Zarządzanie grupą (edycja danych)}
Edycja danych grupy jest dostępna dla użytkownika z rolą \textbf{właściciela}. Właściciel może przełączyć widok szczegółów w tryb edycji i zmienić nazwę, opis oraz adres grupy. Po zapisaniu zmian dane są aktualizowane w systemie.

Podczas edycji adres jest weryfikowany w taki sam sposób jak przy tworzeniu grupy, a zapis zmian powoduje wysłanie zapytania aktualizacyjnego do API.
W ramach zapisu zmian backend ponownie wykonuje geokodowanie adresu w OpenStreetMap (Nominatim), aby zaktualizować współrzędne przypisane do lokalizacji.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek20.png}
\captionT{Edycja danych grupy}
\end{figure}

\subsubsection{Zapraszanie użytkowników do grupy}
Zapraszanie nowych osób do grupy jest dostępne dla \textbf{właściciela} w panelu szczegółów grupy. Zaproszenie odbywa się poprzez podanie \textbf{nazwy użytkownika} osoby, która posiada konto w systemie. Po wysłaniu zaproszenia użytkownik pojawia się na liście członków jako osoba oczekująca na akceptację.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek21.png}
\captionT{Zapraszanie użytkowników do grupy}
\end{figure}

\subsubsection{Zaproszenia oczekujące (akceptacja/odrzucenie)}
Użytkownik, który otrzymał zaproszenie do grupy, widzi je w sekcji \textbf{zaproszeń oczekujących} w widoku zarządzania grupami. Dla każdego zaproszenia dostępne są akcje \textbf{Akceptuj} oraz \textbf{Odrzuć}. Akceptacja powoduje dołączenie do grupy, a odrzucenie usuwa zaproszenie.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek22.png}
\captionT{Obsługa zaproszeń do grup}
\end{figure}

\subsubsection{Usuwanie użytkownika z grupy}
Właściciel grupy może usunąć użytkownika będącego członkiem grupy. Akcja usunięcia jest dostępna przy danym użytkowniku na liście członków. Usunięcie powoduje, że użytkownik przestaje widzieć grupę na swojej liście oraz traci dostęp do jej panelu.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek23.png}
\captionT{Usuwanie członka z grupy}
\end{figure}

\subsection{Panel grupy i czat (Group Chat)}
Panel grupy zawiera zakładkę \textbf{Czat}, która umożliwia komunikację pomiędzy członkami danej grupy. Czat jest dostępny wyłącznie dla użytkowników będących \textbf{członkami grupy} (zaproszenie nie może być w stanie oczekującym). W aktualnej wersji systemu rola \textbf{Garbage Admin} nie może dołączyć do czatu grupy.

Komunikacja jest realizowana w czasie rzeczywistym poprzez połączenie \textbf{SignalR} (hub \texttt{/chatHub}).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek24.png}
\captionT{Zakładka czatu w panelu grupy}
\end{figure}

\subsubsection{Widok wiadomości}
Wiadomości prezentowane są w kolejności chronologicznej (od najstarszej do najnowszej) i zawierają podstawowe informacje:
\begin{itemize}
\item nazwę użytkownika (nadawcy),
\item treść wiadomości,
\item czas wysłania.
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek25.png}
\captionT{Widok wiadomości w czacie grupy}
\end{figure}

\subsubsection{Dodawanie wiadomości}
Aby dodać wiadomość, użytkownik wpisuje treść w polu edycji i wysyła ją przyciskiem \textit{Wyślij} lub klawiszem \textit{Enter} (z użyciem \textit{Shift+Enter} możliwe jest wstawienie nowej linii). Po poprawnym wysłaniu wiadomość pojawia się na liście.

Treść wiadomości jest walidowana:
\begin{itemize}
\item wiadomość nie może być pusta (po usunięciu białych znaków),
\item maksymalna długość wiadomości wynosi \textbf{2000} znaków.
\end{itemize}

W interfejsie widoczny jest również stan połączenia: \textit{disconnected}, \textit{connecting}, \textit{connected}, \textit{reconnecting}, \textit{error}. Jeżeli połączenie w czasie rzeczywistym jest niedostępne, użytkownik nadal może korzystać z historii i wysyłania wiadomości poprzez zapytania do API, a aplikacja wyświetla komunikat o stanie połączenia.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek26.png}
\captionT{Wysyłanie wiadomości w czacie grupy}
\end{figure}

\subsection{Zamówienia odbioru odpadów (Garbage Orders)}
Moduł zamówień odbioru odpadów umożliwia złożenie zlecenia odbioru w ramach wybranej grupy oraz rozliczenie kosztów pomiędzy uczestnikami. Z punktu widzenia użytkownika proces składa się z: utworzenia zamówienia (krok po kroku), kalkulacji kosztu, a następnie płatności udziału w kosztach.

\subsubsection{Utworzenie zamówienia (krok po kroku)}
Tworzenie zamówienia odbywa się w widoku \textit{Zamów wywóz} i jest zorganizowane w formie kreatora (steppera) z pięcioma krokami:
\begin{itemize}
\item \textbf{Krok 1 --- Rodzaj wywozu (order type).} Użytkownik wybiera wariant odbioru: \textit{SmallPickup}, \textit{Pickup} albo \textit{Container}. Wariant \textit{SpecialOrder} jest widoczny w interfejsie, ale jest oznaczony jako niedostępny.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek27.png}
\captionT{Kreator zamówienia: krok 1 --- wybór rodzaju wywozu}
\end{figure}

\item \textbf{Krok 2 --- Grupa i uczestnicy.} Użytkownik wybiera grupę (w tym grupę prywatną) i zaznacza uczestników, którzy będą rozliczani za zamówienie. Osoby ze statusem oczekującego członkostwa (pending) są prezentowane na liście, ale nie mogą zostać wybrane.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek28.png}
\captionT{Kreator zamówienia: krok 2 --- wybór grupy i uczestników}
\end{figure}

\item \textbf{Krok 3 --- Adres i termin.} W kreatorze prezentowany jest adres wybranej grupy (ulica oraz kod pocztowy i miasto). W tym kroku użytkownik ustawia termin odbioru (data + godzina). Dla wariantu \textit{Container} wymagane jest również podanie terminu podstawienia kontenera (data + godzina), a aplikacja waliduje poprawność sekwencji terminów.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek29.png}
\captionT{Kreator zamówienia: krok 3 --- adres i termin}
\end{figure}

\item \textbf{Krok 4 --- Szczegóły zamówienia.} Dostępne są dodatkowe opcje: \textit{wysoki priorytet} oraz \textit{usługa wyniesienia}. Dla wariantu \textit{Container} wymagany jest wybór rozmiaru kontenera. 

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek30.png}
\captionT{Kreator zamówienia: krok 4 --- szczegóły zamówienia}
\end{figure}

\item \textbf{Krok 5 --- Podsumowanie.} Użytkownik widzi podsumowanie: grupę i adres, typ odbioru, harmonogram oraz wybrane opcje. W tym kroku prezentowany jest również \textbf{szacunkowy koszt wywozu} (kalkulacja). Z tego miejsca możliwe jest wysłanie zamówienia.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek31.png}
\captionT{Kreator zamówienia: krok 5 --- podsumowanie}
\end{figure}
\end{itemize}

W formularzu kreatora obowiązują walidacje wymaganych pól (m.in. wybór typu, grupy, uczestników, terminu). Dodatkowo aplikacja blokuje wskazanie terminu w przeszłości.

\subsubsection{Kalkulacja kosztu zamówienia}
W kroku \textit{Podsumowanie} aplikacja automatycznie wykonuje kalkulację kosztu poprzez zapytanie do API. Kalkulacja jest prezentowana w interfejsie jako wartość szacunkowa (estimate) i składa się z:
\begin{itemize}
\item \textbf{EstimatedCost} --- koszt bazowy usługi (po uwzględnieniu wybranych opcji),
\item \textbf{PrepaidUtilizationFee} --- część przedpłacona na poczet opłaty utylizacyjnej,
\item \textbf{EstimatedTotalCost} --- koszt całkowity (suma kosztu bazowego i części przedpłaconej).
\end{itemize}

W aktualnej implementacji koszt bazowy jest wyliczany na podstawie typu usługi i opcji:
\begin{itemize}
\item \textit{SmallPickup}: 50.00,
\item \textit{Pickup}: 80.00,
\item \textit{Container}: 120.00 + dopłata za rozmiar kontenera (40.00 / 60.00 / 90.00) + opłata dzienna za wynajem kontenera 15.00 za każdy dzień pomiędzy datą podstawienia a datą odbioru,
\item \textit{CollectingService}: +35.00 (jeżeli włączone),
\item \textit{HighPriority}: mnożnik 1.25 (jeżeli włączone).
\end{itemize}

Po wyliczeniu kosztu bazowego jest on zaokrąglany do dwóch miejsc po przecinku, a następnie koszt całkowity powstaje przez zastosowanie mnożnika 1.25 (wbudowana przedpłata na opłatę utylizacyjną). Część \textit{PrepaidUtilizationFee} jest różnicą: \textit{EstimatedTotalCost} $-$ \textit{EstimatedCost}.

Jeżeli użytkownik nie uzupełni wymaganych danych potrzebnych do kalkulacji, w podsumowaniu wyświetlany jest komunikat o braku możliwości wyliczenia kosztu. Dla \textit{SpecialOrder} kalkulacja w podsumowaniu nie jest wykonywana.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek32.png}
\captionT{Kalkulacja kosztu w podsumowaniu zamówienia}
\end{figure}

\subsection{Rozliczenie zamówień (płatność, szczegóły i opłaty)}
Ta sekcja opisuje etapy po złożeniu zamówienia: opłacenie udziału w koszcie, przegląd własnych zleceń, wgląd w szczegóły zamówienia oraz rozliczenie ewentualnej opłaty utylizacyjnej.

\subsubsection{Płatność za zamówienie (udział uczestnika)}
Po wysłaniu zamówienia z kreatora zlecenie zostaje utworzone ze statusem \textit{WaitingForPayment}. W tym statusie każdy uczestnik widzi w szczegółach zamówienia swój udział w koszcie (\textit{ShareAmount}) i może zrealizować płatność.

Płatność jest realizowana z portfela użytkownika:
\begin{itemize}
\item jeżeli saldo jest niewystarczające, API zwraca błąd \textit{NotEnoughFunds} i płatność nie zostaje wykonana,
\item jeżeli udział użytkownika wynosi 0.00, płatność zostaje oznaczona jako wykonana bez obciążenia portfela,
\item po wykonaniu płatności użytkownik jest oznaczany jako opłacony (\textit{HasAcceptedPayment}).
\end{itemize}

Po opłaceniu udziałów przez wszystkich uczestników status zamówienia automatycznie przechodzi na \textit{WaitingForAccept} (oczekiwanie na akceptację przez Administratora odpadów).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek33.png}
\captionT{Płatność udziału w koszcie zamówienia}
\end{figure}

\subsubsection{Moje odbiory (lista zamówień użytkownika)}
Widok \textit{Moje odbiory} prezentuje listę zamówień użytkownika w formie tabeli. Lista jest stronicowana oraz umożliwia filtrowanie:
\begin{itemize}
\item po statusie (m.in. \textit{WaitingForPayment}, \textit{WaitingForAccept}, \textit{WaitingForPickup}, \textit{WaitingForUtilizationFee}, \textit{Completed}, \textit{Complained}, \textit{Resolved}, \textit{Cancelled}),
\item po grupie (wybrana grupa lub wszystkie).
\end{itemize}

W tabeli widoczne są: numer zamówienia, grupa, status, koszt, termin odbioru, typ usługi oraz przycisk przejścia do szczegółów.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek34.png}
\captionT{Lista zamówień w widoku Moje odbiory}
\end{figure}

\subsubsection{Szczegóły zamówienia}
Widok szczegółów zamówienia zawiera:
\begin{itemize}
\item podsumowanie (termin, typ odbioru, koszt, grupa, opcje \textit{wysoki priorytet} i \textit{usługa wyniesienia}),
\item sekcję przypisanego Administratora odpadów (widoczna po akceptacji zamówienia przez administratora),
\item tabelę uczestników z udziałami w kosztach oraz informacją, czy uczestnik opłacił zamówienie,
\item w zależności od statusu: sekcję płatności zamówienia (\textit{WaitingForPayment}) lub sekcję opłaty utylizacyjnej (\textit{WaitingForUtilizationFee}).
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek35.png}
\captionT{Szczegóły zamówienia: podsumowanie i uczestnicy}
\end{figure}

\subsubsection{Dodatkowa opłata utylizacyjna (udział w koszcie)}
Po akceptacji zamówienia przez Administratora odpadów (status \textit{WaitingForPickup}) zamówienie jest realizowane. Po wykonaniu usługi Administrator odpadów zgłasza opłatę utylizacyjną wraz z dowodem (załącznikiem). Wymagania dla załącznika po stronie systemu:
\begin{itemize}
\item typ pliku: JPG, PNG, WEBP, GIF lub PDF,
\item maksymalny rozmiar: 10 MB.
\end{itemize}

Po zgłoszeniu opłaty utylizacyjnej status zamówienia przechodzi na \textit{WaitingForUtilizationFee}. Użytkownik w szczegółach zamówienia widzi dowód (załącznik) oraz kwotę dopłaty przypisaną do swojego udziału (\textit{AdditionalUtilizationFeeShareAmount}).

Rozliczenie działa w następujący sposób:
\begin{itemize}
\item Jeżeli zgłoszona opłata utylizacyjna jest mniejsza lub równa części przedpłaconej (\textit{PrepaidUtilizationFee}), zamówienie zostaje zakończone (\textit{Completed}), a niewykorzystana część przedpłaty jest zwracana na portfele uczestników.
\item Jeżeli zgłoszona opłata utylizacyjna przekracza część przedpłaconą, system wylicza kwotę dopłaty i rozdziela ją na uczestników. Każdy użytkownik opłaca swój udział w dopłacie z portfela. Po opłaceniu dopłaty przez wszystkich uczestników status zamówienia przechodzi na \textit{Completed}.
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek36.png}
\captionT{Dodatkowa opłata utylizacyjna i płatność udziału}
\end{figure}

\subsection{Skrzynka odbiorcza (Inbox) i powiadomienia}
Skrzynka odbiorcza (Inbox) jest dostępna w portalu użytkownika i służy do prezentowania powiadomień systemowych oraz wykonywania akcji powiązanych z wybranymi komunikatami.

\subsubsection[Licznik wiadomości i powiadomienia]{Licznik wiadomości i powiadomienia w czasie rzeczywistym}
\begin{sloppypar}
W topbarze aplikacji widoczna jest ikona dzwonka prowadząca do widoku skrzynki odbiorczej. Jeżeli w skrzynce znajdują się wiadomości, obok ikony wyświetlany jest licznik przedstawiający łączną liczbę wiadomości w Inbox.
\end{sloppypar}

Licznik jest aktualizowany dwoma kanałami:
\begin{itemize}
\item przez odświeżenie stanu z API (zapytanie o licznik wiadomości),
\item w czasie rzeczywistym poprzez SignalR (hub \texttt{/notificationHub}) dla zdarzeń, które wysyłają aktualizację licznika.
\end{itemize}

Po odebraniu aktualizacji w czasie rzeczywistym interfejs wyświetla informację o nowym powiadomieniu oraz animuje ikonę skrzynki w topbarze.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek37.png}
\captionT{Licznik wiadomości w skrzynce odbiorczej (topbar)}
\end{figure}

\subsubsection{Lista wiadomości (paginacja)}
Widok Inbox prezentuje listę wiadomości w formie listy kart/pozycji. Wiadomości pobierane są z API w sposób stronicowany (paginacja) z parametrami \textit{pageNumber} i \textit{pageSize}. Domyślny rozmiar strony to 10 elementów.

Wiadomości są sortowane malejąco po czasie utworzenia (od najnowszych do najstarszych). Każda wiadomość zawiera:
\begin{itemize}
\item tytuł,
\item treść,
\item czas utworzenia (prezentowany w formacie lokalnym w zależności od wybranego języka interfejsu).
\end{itemize}

W nagłówku widoku Inbox widoczna jest również liczba wiadomości na aktualnie wyświetlanej stronie.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek38.png}
\captionT{Lista wiadomości w skrzynce odbiorczej (paginacja)}
\end{figure}

\subsubsection{Akcje na wiadomościach (akceptacja/odrzucenie)}
\begin{sloppypar}
Wybrane wiadomości mogą posiadać typ akcji (\textit{Action\allowbreak Type}) i identyfikator obiektu powiązanego (\textit{Related\allowbreak Entity\allowbreak Id}). W zależności od typu wiadomości, w interfejsie mogą pojawić się przyciski akcji.
\end{sloppypar}

W aktualnej implementacji akcje \textbf{Akceptuj} / \textbf{Odrzuć} są dostępne wyłącznie dla wiadomości typu \textit{GroupInvitation} (zaproszenie do grupy):
\begin{itemize}
\item \textbf{Akceptuj} --- użytkownik dołącza do grupy, a zaproszenie przestaje być oczekujące,
\item \textbf{Odrzuć} --- zaproszenie jest usuwane, a użytkownik nie dołącza do grupy.
\end{itemize}
Po wykonaniu akcji wiadomość jest usuwana ze skrzynki, a licznik w topbarze jest odświeżany.

Niezależnie od powyższego, dla wybranych typów wiadomości w interfejsie dostępny jest przycisk \textbf{Otwórz}, który przenosi użytkownika do powiązanego miejsca w portalu.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek39.png}
\captionT{Akcje na wiadomościach w skrzynce odbiorczej}
\end{figure}

\subsubsection{Usuwanie wiadomości}
Każda wiadomość może zostać usunięta ręcznie z poziomu listy poprzez przycisk zamknięcia (\textit{X}) widoczny przy danej pozycji. Usunięcie powoduje trwałe skasowanie wiadomości z Inbox dla danego użytkownika.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek40.png}
\captionT{Usuwanie pojedynczej wiadomości ze skrzynki}
\end{figure}

\subsubsection{Czyszczenie skrzynki}
W nagłówku widoku Inbox dostępny jest przycisk \textbf{Wyczyść wszystko}, który usuwa wszystkie wiadomości użytkownika ze skrzynki. Przycisk jest widoczny tylko wtedy, gdy lista zawiera co najmniej jedną wiadomość. Po poprawnym czyszczeniu użytkownik otrzymuje komunikat potwierdzający, a lista jest odświeżana.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek41.png}
\captionT{Czyszczenie skrzynki odbiorczej}
\end{figure}

\subsection{Funkcje dla Administratora odpadów (Garbage Admin)}
\subsubsection{Zgoda administratora odpadów (treść i akceptacja)}
Po zalogowaniu do portalu użytkownik z rolą \textbf{GarbageAdmin} może zostać poproszony o zaakceptowanie wymaganej zgody. Treść zgody jest pobierana z API (dedykowany endpoint \texttt{/garbage-admin-\allowbreak consents}) i prezentowana w modalu w formie tekstu.

Modal zgody jest wyświetlany automatycznie, jeżeli w danych bieżącego użytkownika pole \textit{acceptedConsents} ma wartość \textit{false}. Do czasu rozstrzygnięcia zgody modal pozostaje na wierzchu interfejsu.

W modalu dostępne są dwie akcje:
\begin{itemize}
\item \textbf{Akceptuj} --- aplikacja wysyła żądanie akceptacji zgody do API (\texttt{PATCH /user/\allowbreak consents/\allowbreak accept}). Po powodzeniu pole \textit{acceptedConsents} jest ustawiane na \textit{true}, a modal zostaje zamknięty.
\item \textbf{Odrzuć} --- aplikacja wylogowuje użytkownika i przenosi do ekranu logowania (\texttt{/auth}).
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek42.png}
\captionT{Zgoda Administratora odpadów: prezentacja treści}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek43.png}
\captionT{Zgoda Administratora odpadów: akcje użytkownika}
\end{figure}

\subsubsection{Zlecenia oczekujące (waiting)}
Widok \textit{Zlecenia oczekujące} jest dostępny w portalu pod ścieżką \texttt{/portal/\allowbreak garbage-admin/\allowbreak orders/\allowbreak waiting}. Prezentuje listę zleceń w statusie \textit{WaitingForAccept} (oczekujących na przyjęcie przez administratora).

Lista jest stronicowana (domyślny rozmiar strony: 10). Dla każdego zlecenia prezentowane są m.in.:
\begin{itemize}
\item skrócony kod zlecenia (identyfikator w formie \texttt{XXXX-YYYY}),
\item status zlecenia,
\item rodzaj wywozu (\textit{PickupOption}),
\item termin(y) realizacji: \textit{Schedule} (dla usług innych niż kontener) lub osobno \textit{Drop-off} i \textit{Pickup} (dla kontenera),
\item rozmiar kontenera (jeżeli dotyczy),
\item koszt w PLN,
\item odległość w km (jeżeli jest dostępna),
\item adres grupy (formatowany zgodnie z aktualnym językiem interfejsu).
\end{itemize}

Na karcie zlecenia mogą pojawić się oznaczenia: \textbf{wysoki priorytet} oraz \textbf{usługa wyniesienia} (\textit{collectingService}).

Widok udostępnia przycisk \textbf{Odśwież} oraz stany: ładowanie, błąd pobierania oraz pustą listę (brak zleceń oczekujących).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek44.png}
\captionT{Zlecenia oczekujące (waiting) w panelu Garbage Admin}
\end{figure}

\subsubsection{Akceptacja zlecenia}
Na każdej karcie zlecenia oczekującego dostępny jest przycisk \textbf{Akceptuj}. Po jego użyciu aplikacja wysyła żądanie akceptacji zlecenia do API, a następnie odświeża listę. W trakcie wykonywania operacji przycisk jest blokowany, a w interfejsie widoczny jest wskaźnik ładowania.

Po poprawnej akceptacji zlecenie znika z listy \textit{waiting} i staje się zleceniem przypisanym do administratora (widocznym w widoku zleceń przypisanych/aktywnych).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek45.png}
\captionT{Akceptacja zlecenia w widoku waiting}
\end{figure}

\subsubsection{Zlecenia przypisane/aktywne (assigned/current)}
Widok \textit{Zlecenia przypisane} jest dostępny w portalu pod ścieżką \texttt{/portal/\allowbreak garbage-admin/\allowbreak orders/\allowbreak assigned}. Prezentuje zlecenia przypisane do zalogowanego administratora.

W porównaniu do listy \textit{waiting}, na karcie zlecenia widoczna jest również informacja o \textbf{nazwie grupy} oraz oznaczenie, czy jest to \textbf{grupa prywatna} (tag \textit{private}). Widok oferuje przycisk \textbf{Odśwież}, stronicowanie (10 elementów na stronę) oraz stany: ładowanie, błąd oraz pustą listę.

W dolnej części karty dostępne są akcje:
\begin{itemize}
\item \textbf{Czat} --- w aktualnej wersji jest to funkcja poglądowa (wyświetla komunikat o braku implementacji czatu dla zlecenia),
\item \textbf{Zgłoś opłatę} --- otwiera modal zgłoszenia opłaty utylizacyjnej.
\end{itemize}

Jeżeli opłata utylizacyjna została już zgłoszona, przycisk \textbf{Zgłoś opłatę} jest nieaktywny, a na karcie pojawia się dodatkowa informacja o oczekiwaniu na rozliczenie.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek46.png}
\captionT{Zlecenia przypisane/aktywne (assigned/current) w panelu Garbage Admin}
\end{figure}

\subsubsection{Zgłoszenie opłaty utylizacyjnej (załącznik)}
Zgłoszenie opłaty utylizacyjnej odbywa się z poziomu widoku \textit{Zlecenia przypisane} przez przycisk \textbf{Zgłoś opłatę}. Aplikacja otwiera modal, w którym administrator uzupełnia:
\begin{itemize}
\item \textbf{kwotę} (pole liczbowe z krokiem 0.01),
\item \textbf{załącznik} (plik typu obraz lub PDF; pole wyboru pliku akceptuje \texttt{image/*} oraz \texttt{application/pdf}).
\end{itemize}
Przycisk wysłania zgłoszenia jest aktywny dopiero po podaniu kwoty oraz załączeniu pliku.

Po zatwierdzeniu aplikacja wysyła zgłoszenie do API jako żądanie \textit{multipart/form-data}. W przypadku błędu API może zwrócić m.in.:
\begin{itemize}
\item \textit{UNSUPPORTED\_\allowbreak IMAGE\_\allowbreak TYPE} --- gdy załącznik ma niedozwolony typ,
\item \textit{INVALID\_\allowbreak ORDER\_\allowbreak STATUS} --- gdy zlecenie nie jest w statusie pozwalającym na zgłoszenie opłaty.
\end{itemize}

W aktualnej implementacji system dopuszcza załączniki: JPG, PNG, WEBP, GIF lub PDF (maks. 10 MB), zgodnie z ograniczeniami opisanymi w sekcji o rozliczeniu opłaty utylizacyjnej.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek47.png}
\captionT{Zgłoszenie opłaty utylizacyjnej przez Administratora odpadów}
\end{figure}

\subsection{Przykładowe działanie systemu (scenariusze)}
\subsubsection{Rejestracja i aktywacja konta}
Ten scenariusz opisuje utworzenie konta w aplikacji oraz aktywację konta z wykorzystaniem linku przesłanego e-mailem.

\begin{enumerate}
\item Użytkownik przechodzi do ekranu logowania/rejestracji (\textit{Auth}). Następnie wybiera tryb rejestracji.
\item W kroku 1 rejestracji uzupełnia \textbf{nazwę użytkownika}, \textbf{adres e-mail} oraz \textbf{hasło}. Wybiera również rolę konta: \textbf{User} lub \textbf{GarbageAdmin}.
\item W kroku 2 rejestracji wybiera \textbf{język} interfejsu oraz uzupełnia \textbf{adres} (miasto z listy, kod pocztowy oraz ulica z numerem).
\item Jeżeli wybrano rolę \textbf{GarbageAdmin}, w kroku 3 rejestracji użytkownik wskazuje co najmniej jedną \textbf{preferencję rodzaju odbioru} (lista typów odbioru). Bez wyboru preferencji zakończenie rejestracji jest blokowane walidacją formularza.
\item Po poprawnym wysłaniu formularza system wyświetla komunikat informujący o utworzeniu konta oraz wysyła wiadomość e-mail z linkiem aktywacyjnym w formacie \texttt{/activate-account/\allowbreak TOKEN}.
\item Użytkownik otwiera link aktywacyjny. Aplikacja uruchamia widok aktywacji i wysyła żądanie aktywacji konta do API. Po poprawnym zakończeniu operacji konto zostaje aktywowane.
\item Po aktywacji system tworzy dla użytkownika \textbf{portfel} (saldo początkowe 0.00) oraz \textbf{grupę prywatną} przypisaną do użytkownika (członkostwo w roli właściciela).
\item Użytkownik może przejść do logowania i uzyskać dostęp do portalu.
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek48.png}
\captionT{Scenariusz: rejestracja konta (krok 1)}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek49.png}
\captionT{Scenariusz: aktywacja konta z linku e-mail}
\end{figure}

\subsubsection{Utworzenie grupy i zaproszenie użytkowników}
Ten scenariusz opisuje utworzenie nowej grupy odpadów oraz wysłanie zaproszenia do istniejącego użytkownika. Zaproszenie jest realizowane przez podanie \textbf{nazwy użytkownika} osoby zapraszanej.

\begin{enumerate}
\item Użytkownik (właściciel) przechodzi do \textit{Portal \textrightarrow{} Grupy \textrightarrow{} Zarządzanie}.
\item Uzupełnia formularz tworzenia grupy: \textbf{nazwa}, \textbf{opis} oraz \textbf{adres} (miasto, kod pocztowy, ulica z numerem).
\item Po utworzeniu grupy aplikacja przechodzi do panelu grupy (szczegóły).
\item W panelu grupy, w sekcji zaproszeń, właściciel wpisuje \textbf{nazwę użytkownika} osoby zapraszanej i zatwierdza zaproszenie.
\item Zaproszony użytkownik widzi zaproszenie jako \textbf{oczekujące}: (1) w widoku zarządzania grupami jako pozycję na liście zaproszeń oczekujących, oraz (2) w skrzynce odbiorczej (Inbox) jako wiadomość z akcją \textit{GroupInvitation}.
\item Do czasu zaakceptowania zaproszenia użytkownik jest oznaczony jako \textit{pending} w członkach grupy.
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek50.png}
\captionT{Scenariusz: utworzenie grupy odpadów}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek51.png}
\captionT{Scenariusz: wysłanie zaproszenia do grupy}
\end{figure}

\subsubsection{Złożenie zamówienia oraz płatność}
Ten scenariusz opisuje utworzenie zamówienia odbioru odpadów dla wybranej grupy oraz opłacenie udziałów przez uczestników.

\begin{enumerate}
\item Użytkownik przechodzi do widoku \textit{Portal \textrightarrow{} Zamówienia odbioru \textrightarrow{} Zamów wywóz}.
\item W kreatorze zamówienia wybiera \textbf{rodzaj wywozu}, następnie wskazuje \textbf{grupę} oraz \textbf{uczestników}.
\item Ustawia \textbf{termin odbioru} (data i godzina). Dla wariantu \textit{Container} uzupełnia również termin podstawienia kontenera.
\item W kroku podsumowania aplikacja wyświetla \textbf{szacunkowy koszt wywozu} (kalkulacja) oraz umożliwia wysłanie zamówienia.
\item Po utworzeniu zamówienia zlecenie otrzymuje status \textit{WaitingForPayment}.
\item Każdy uczestnik przechodzi do widoku \textit{Portal \textrightarrow{} Moje odbiory}, otwiera szczegóły zamówienia i wykonuje płatność swojego udziału.
\item Jeżeli saldo w portfelu jest niewystarczające, płatność nie jest wykonywana, a API zwraca błąd \textit{NotEnoughFunds}.
\item Gdy wszyscy uczestnicy opłacą swoje udziały, status zamówienia przechodzi na \textit{WaitingForAccept} i zamówienie oczekuje na akceptację przez Administratora odpadów.
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek52.png}
\captionT{Scenariusz: podsumowanie zamówienia i szacunkowy koszt}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek53.png}
\captionT{Scenariusz: płatność udziału w zamówieniu}
\end{figure}

\subsubsection{Komunikacja w czacie grupy}
Ten scenariusz opisuje komunikację w czacie przypisanym do grupy.

\begin{enumerate}
\item Użytkownik będący członkiem grupy (zaproszenie nie może być w stanie \textit{pending}) przechodzi do panelu grupy: \textit{Portal \textrightarrow{} Grupy \textrightarrow{} (wybór grupy)}.
\item W panelu wybiera zakładkę \textbf{Czat}. Po aktywowaniu zakładki aplikacja pobiera historię wiadomości (stronicowanie) oraz inicjuje połączenie w czasie rzeczywistym z hubem \texttt{/chatHub}.
\item W czacie użytkownik wpisuje treść wiadomości i wysyła ją klawiszem \textit{Enter} lub przyciskiem wysyłania. \textit{Shift+Enter} pozwala wstawić nową linię.
\item Treść wiadomości nie może być pusta oraz nie może przekroczyć \textbf{2000} znaków.
\item Nowe wiadomości są dodawane do listy oraz mogą być dostarczane innym członkom grupy w czasie rzeczywistym.
\item Rola \textbf{GarbageAdmin} nie może dołączyć do czatu grupy (połączenie jest odrzucane).
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek54.png}
\captionT{Scenariusz: komunikacja w czacie grupy}
\end{figure}

\subsubsection[Obsługa zaproszeń i akcji]{Obsługa zaproszeń i akcji z poziomu skrzynki odbiorczej}
Ten scenariusz opisuje przyjęcie lub odrzucenie zaproszenia do grupy z poziomu Inbox.

\begin{enumerate}
\item Właściciel grupy wysyła zaproszenie do użytkownika (podając jego nazwę użytkownika w panelu grupy).
\item Zaproszony użytkownik przechodzi do skrzynki odbiorczej: \textit{Portal \textrightarrow{} Skrzynka odbiorcza}.
\item W Inbox pojawia się wiadomość z akcją \textit{GroupInvitation}. Dla tej wiadomości dostępne są przyciski \textbf{Akceptuj} oraz \textbf{Odrzuć}.
\item Po wybraniu \textbf{Akceptuj} użytkownik zostaje dodany do grupy, a zaproszenie przestaje być oczekujące.
\item Po wybraniu \textbf{Odrzuć} zaproszenie jest usuwane, a użytkownik nie dołącza do grupy.
\item Po wykonaniu akcji wiadomość jest usuwana ze skrzynki odbiorczej, a licznik wiadomości w topbarze jest odświeżany.
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek55.png}
\captionT{Scenariusz: obsługa zaproszenia do grupy w Inbox}
\end{figure}

\subsubsection[Scenariusz Garbage Admin]{Scenariusz Garbage Admin: akceptacja zlecenia i rozliczenie opłaty}
Ten scenariusz opisuje działania użytkownika z rolą \textbf{GarbageAdmin}: akceptację wymaganej zgody, przyjęcie zlecenia oraz zgłoszenie opłaty utylizacyjnej.

\begin{enumerate}
\item Użytkownik loguje się na konto o roli \textbf{GarbageAdmin}.
\item Po wejściu do portalu, jeżeli zgody administratora nie zostały zaakceptowane, aplikacja wyświetla modal z treścią zgody (pobieraną z API).
\item Użytkownik wybiera \textbf{Akceptuj} (zgoda zostaje zapisana w systemie) albo \textbf{Odrzuć} (użytkownik zostaje wylogowany i przeniesiony do ekranu logowania).
\item Po akceptacji zgody administrator przechodzi do listy zleceń oczekujących: \textit{Portal \textrightarrow{} Garbage Admin \textrightarrow{} Zlecenia oczekujące}.
\item Administrator wybiera zlecenie i wykonuje akcję \textbf{Akceptuj}. Operacja przypisuje zlecenie do administratora i ustawia status \textit{WaitingForPickup}.
\item Następnie administrator przechodzi do listy zleceń przypisanych/aktywnych: \textit{Portal \textrightarrow{} Garbage Admin \textrightarrow{} Zlecenia przypisane}.
\item Po wykonaniu usługi administrator zgłasza opłatę utylizacyjną: otwiera modal, podaje \textbf{kwotę} oraz dołącza \textbf{załącznik} (JPG, PNG, WEBP, GIF lub PDF; maks. 10 MB) i zatwierdza.
\item Po zgłoszeniu opłaty utylizacyjnej zamówienie przechodzi na status \textit{WaitingForUtilizationFee}, a użytkownicy mogą opłacić ewentualne udziały w dopłacie z poziomu szczegółów zamówienia.
\item W widoku zleceń przypisanych dostępny jest również przycisk otwarcia czatu dla zlecenia, jednak w aktualnej wersji jest to funkcja poglądowa i wyświetla komunikat o braku implementacji.
\end{enumerate}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek56.png}
\captionT{Scenariusz Garbage Admin: akceptacja zgody}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek57.png}
\captionT{Scenariusz Garbage Admin: akceptacja zlecenia}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\linewidth]{images/Rysunek58.png}
\captionT{Scenariusz Garbage Admin: zgłoszenie opłaty utylizacyjnej}
\end{figure}





\renewcommand\refname{Literatura (jeżeli wymagana)}
\bibliography{references}
\addcontentsline{toc}{section}{Literatura}
% --------------------------------------------------------------------
%%%%%%% odkomentować gdy bibliografia ma być wewnątrz dokumentu
% --------------------------------------------------------------------
%\begin{thebibliography}{11}
%
%\addcontentsline{toc}{section}{Literatura}
%
%\bibitem{ZAN}
%C. Zannoni and P. Pasini, 
%\emph{Advances in the Computer Simulatons of Liquid Crystals}, Kluwer Academic Publishers, 2000.
%
%\end{thebibliography}

\end{document}

