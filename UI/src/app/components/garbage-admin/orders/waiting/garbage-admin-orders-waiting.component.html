<div class="container-fluid px-3 orders-list-container">
  <div class="card fancy-card h-100 border-0 shadow-lg mx-auto">
    <div class="card-header gradient-groups text-white py-3 position-relative overflow-hidden">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <div class="card-heading">
          <div class="card-heading__icon card-heading__icon--list">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" focusable="false">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <div>
            <h5 class="mb-1 fw-bold">{{ 'garbageAdminOrders.waiting.title' | translate }}</h5>
            <small class="opacity-75">{{ 'garbageAdminOrders.waiting.lead' | translate }}</small>
          </div>
        </div>
        <div class="d-flex align-items-center gap-2">
          <button
            type="button"
            class="btn btn-xs btn-outline-light refresh-btn"
            (click)="refresh()"
            [disabled]="loading()"
          >
            <span *ngIf="loading()" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <span *ngIf="!loading()" class="d-inline-flex align-items-center gap-1">
              <i class="bi bi-arrow-clockwise"></i>
              <span class="refresh-label">{{ 'garbageAdminOrders.actions.refresh' | translate }}</span>
            </span>
          </button>
        </div>
      </div>
      <div class="header-accent"></div>
    </div>

    <div class="card-body p-0 d-flex flex-column bg-light">
      <section class="orders-section p-3">
        <div *ngIf="loading()" class="orders-state orders-state--loading">
          <div class="spinner-border" role="status" aria-hidden="true"></div>
          <small class="text-muted">{{ 'garbageAdminOrders.loading' | translate }}</small>
        </div>

        <div *ngIf="!loading() && error()" class="orders-state orders-state--error">
          <p class="mb-2">{{ (error() ?? 'garbageAdminOrders.waiting.loadError') | translate }}</p>
          <button type="button" class="btn btn-sm btn-primary" (click)="retry()">
            {{ 'garbageAdminOrders.actions.retry' | translate }}
          </button>
        </div>

        <div *ngIf="!loading() && !error() && items().length === 0" class="orders-state orders-state--empty">
          <div class="orders-state__icon" aria-hidden="true">&#128210;</div>
          <h3 class="h6 mb-1">{{ 'garbageAdminOrders.waiting.empty.title' | translate }}</h3>
          <p class="text-muted mb-0">{{ 'garbageAdminOrders.waiting.empty.lead' | translate }}</p>
        </div>

        <div *ngIf="!loading() && !error() && items().length" class="orders-list">
          <article
            class="order-card"
            *ngFor="let item of items(); trackBy: trackById"
            [class.order-card--priority]="item.isHighPriority"
          >
            <header class="order-card__header">
              <div>
                <span class="order-card__code">{{ item.orderNumber }}</span>
              </div>
              <span class="badge text-uppercase" [ngClass]="item.statusClass">{{ item.statusKey | translate }}</span>
            </header>

            <div class="order-card__body">
              <div class="order-card__summary">
                <div class="order-card__row">
                  <span class="order-card__label">{{ 'garbageAdminOrders.summary.pickupOption' | translate }}</span>
                  <span class="order-card__value">{{ item.pickupOptionKey | translate }}</span>
                </div>
                <div class="order-card__row">
                  <span class="order-card__label">{{ 'garbageAdminOrders.summary.schedule' | translate }}</span>
                  <span class="order-card__value">
                    <ng-container *ngIf="item.schedule; else waitingNoSchedule">
                      <time>{{ item.schedule | date:'medium':'':currentLang() }}</time>
                    </ng-container>
                  </span>
                </div>
                <div class="order-card__row" *ngIf="item.containerSizeKey">
                  <span class="order-card__label">{{ 'garbageAdminOrders.summary.containerSize' | translate }}</span>
                  <span class="order-card__value">{{ item.containerSizeKey | translate }}</span>
                </div>
                <div class="order-card__row">
                  <span class="order-card__label">{{ 'garbageAdminOrders.summary.cost' | translate }}</span>
                  <span class="order-card__value">{{ item.cost | currency:'PLN':'symbol':'1.2-2' }}</span>
                </div>
                <div class="order-card__row" *ngIf="item.distance !== null">
                  <span class="order-card__label">{{ 'garbageAdminOrders.summary.distance' | translate }}</span>
                  <span class="order-card__value">{{ item.distance | number:'1.1-1' }} km</span>
                </div>
                <div class="order-card__row" *ngIf="item.addressLine">
                  <span class="order-card__label">{{ 'garbageAdminOrders.summary.address' | translate }}</span>
                  <span class="order-card__value">{{ item.addressLine }}</span>
                </div>
              </div>

              <ul class="order-card__flags">
                <li *ngIf="item.isHighPriority" class="order-card__flag order-card__flag--priority">
                  {{ 'garbageAdminOrders.badges.highPriority' | translate }}
                </li>
                <li *ngIf="item.collectingService" class="order-card__flag">
                  {{ 'garbageAdminOrders.badges.collectingService' | translate }}
                </li>
              </ul>
            </div>

            <footer class="order-card__footer">
              <button
                type="button"
                class="btn btn-primary"
                (click)="acceptOrder(item)"
                [disabled]="isAccepting(item.id)"
              >
                <span *ngIf="isAccepting(item.id)" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                {{ 'acceptOrderCta' | translate }}
              </button>
            </footer>
          </article>
        </div>

        <ng-template #waitingNoSchedule>
          <span class="text-muted">{{ 'garbageAdminOrders.schedule.missing' | translate }}</span>
        </ng-template>

        <div
          *ngIf="!loading() && !error() && pageMeta().totalCount > 0"
          class="orders-pagination"
        >
          <div class="orders-pagination__info">
            {{ 'garbageAdminOrders.pagination.label' | translate:{ start: pageMeta().start, end: pageMeta().end, total: pageMeta().totalCount } }}
          </div>
          <div class="orders-pagination__controls">
            <button type="button" class="page-btn" (click)="previousPage()" [disabled]="!pageMeta().hasPrevious">
              {{ 'paginationPrevious' | translate }}
            </button>
            <span class="orders-pagination__page">
              {{ 'garbageAdminOrders.pagination.page' | translate:{ current: pageMeta().currentPage || 1, total: pageMeta().totalPages || 1 } }}
            </span>
            <button type="button" class="page-btn" (click)="nextPage()" [disabled]="!pageMeta().hasNext">
              {{ 'paginationNext' | translate }}
            </button>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
