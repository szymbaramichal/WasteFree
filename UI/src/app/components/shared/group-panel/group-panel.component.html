<div class="container-fluid px-3">
  <div class="card fancy-card h-100 border-0 shadow-lg mx-auto" style="max-width:1200px;">
    <div class="card-header bg-gradient-green text-white py-3">
      <div class="d-flex align-items-center justify-content-between">
        <h5 class="mb-0 fw-bold d-flex align-items-center gap-2">
          <i class="bi bi-people"></i>
          <span>{{ group?.name || ('groups.details.title' | translate) }}</span>
        </h5>
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-light btn-sm" (click)="retry()" [disabled]="loading">
            <i class="bi bi-arrow-clockwise"></i>
            <span class="ms-1">{{ 'groups.refresh' | translate }}</span>
          </button>
          <a routerLink="/portal/groups" class="btn btn-outline-light btn-sm">
            <i class="bi bi-arrow-left"></i>
            <span class="ms-1">{{ 'common.back' | translate }}</span>
          </a>
        </div>
      </div>
    </div>

    <div class="card-body">
      <div *ngIf="loading" class="text-center p-4 text-muted">
        <div class="spinner-border"></div>
        <div class="small mt-2">{{ 'groups.loading' | translate }}</div>
      </div>

  <div *ngIf="error && !loading" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="warn && !loading" class="alert alert-warning">{{ warn }}</div>

      <ng-container *ngIf="!loading">
        <ng-container *ngIf="group; else groupEmpty">
          <div class="mb-3">
            <div class="fw-semibold">{{ 'groups.details.description' | translate }}</div>
            <div class="text-muted">{{ group.description || '-' }}</div>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-4">
              <div class="fw-semibold">{{ 'groups.details.city' | translate }}</div>
              <div class="text-muted">{{ getGroupCity() || '-' }}</div>
            </div>
            <div class="col-md-4">
              <div class="fw-semibold">{{ 'groups.details.postalCode' | translate }}</div>
              <div class="text-muted">{{ getGroupPostalCode() || '-' }}</div>
            </div>
            <div class="col-md-4">
              <div class="fw-semibold">{{ 'groups.details.address' | translate }}</div>
              <div class="text-muted">{{ getGroupStreet() || '-' }}</div>
            </div>
          </div>

          <!-- Owner actions: invite form -->
          <div class="mb-3" *ngIf="isOwner()">
            <div class="fw-semibold mb-2">{{ 'groups.details.invite.title' | translate }}</div>
            <form class="d-flex gap-2 flex-wrap" (submit)="invite($event, inviteInput.value)">
              <input #inviteInput type="text" class="form-control" style="max-width:260px" [placeholder]="'groups.details.invite.placeholder' | translate" [disabled]="actLoading">
              <button type="submit" class="btn btn-success" [disabled]="actLoading">
                <span *ngIf="!actLoading">{{ 'groups.details.invite.submit' | translate }}</span>
                <span *ngIf="actLoading" class="spinner-border spinner-border-sm"></span>
              </button>
            </form>
          </div>

          <div>
            <div class="fw-semibold mb-2">{{ 'groups.details.members' | translate }}</div>
            <div class="list-group" *ngIf="group.users?.length; else noMembers">
              <div class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let u of group.users">
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-person-circle text-secondary"></i>
                  <div>
                    <div class="fw-semibold">{{ u.username }}</div>
                    <div class="small text-muted" *ngIf="u.isPending">{{ 'groups.details.pending' | translate }}</div>
                  </div>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <span class="badge rounded-pill" [ngClass]="u.garbageGroupRole === GarbageGroupRole.Owner ? 'bg-success' : 'bg-secondary'">
                    {{ u.garbageGroupRole === GarbageGroupRole.Owner ? ('groups.role.owner' | translate) : ('groups.role.member' | translate) }}
                  </span>
                  <button *ngIf="isOwner() && u.garbageGroupRole !== GarbageGroupRole.Owner" class="btn btn-sm btn-outline-danger" (click)="remove(u.id)" [disabled]="actLoading">
                    {{ 'groups.details.remove' | translate }}
                  </button>
                </div>
              </div>
            </div>
            <ng-template #noMembers>
              <div class="text-muted small">-</div>
            </ng-template>
          </div>
        </ng-container>
        <ng-template #groupEmpty>
          <div class="text-muted">{{ 'groups.details.title' | translate }}</div>
        </ng-template>
      </ng-container>
    </div>
  </div>
</div>
